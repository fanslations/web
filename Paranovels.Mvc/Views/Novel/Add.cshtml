@model Paranovels.ViewModels.NovelForm
@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section js {
    <script>
        window.pnHooks.push(function () {
            require(['jquery', 'angular', 'marked'], function ($, angular, marked) {
                'use strict';

                angular
                    .module('novelApp', [])
                    .controller('NovelEntryController', NovelEntryController);
   

                NovelEntryController.$inject = ['$scope'];

                function NovelEntryController($scope, translationService, segmentationService) {
                    var vm = this;

                    vm.chapter = {
                        title: '',
                        content: ''
                    };
                    vm.paragraph = {};
                    vm.originalSegments = [];
                    vm.translatedSegments = [];

                    vm.segment = segment;
                    vm.translate = translate;
                    vm.update = update;
                    vm.editing = editing;
                    vm.close = close;

                    function segment() {
                        vm.originalSegments = segmentationService.segment(vm.chapter.content);
                        vm.translatedSegments = segmentationService.segment(vm.chapter.content);
                        //console.log(vm.segments);
                        angular.forEach(vm.originalSegments, function (segment) {
                            segment.isTranslating = true;
                        });
                    };

                    function translate(p, event) {
                        vm.paragraph.top = event.currentTarget.offsetTop;
                        vm.paragraph.text = p.text;
                        vm.paragraph.isTranslating = true;
                        p.isTranslating = vm.paragraph.isTranslating;
                        console.log('translate', p, event);
                    }

                    function editing(p, event) {
                        angular.forEach(vm.originalSegments, function (segment) {
                            segment.isTranslating = false;
                        });

                        p.isTranslating = true;
                        vm.paragraph = p;

                        console.log('editing', p, event);
                    }

                    function update(p, event) {
                        angular.forEach(vm.originalSegments, function (segment) {
                            segment.isTranslating = true;
                        });

                        var translated = vm.translatedSegments[p.line];
                        translated.text = event.currentTarget.innerText;
                        //vm.paragraph = null;
                        console.log('update', p, event);
                    }

                    function close() {
                        console.log('close');
                    }
                };


                // bootstrap angularjs
                angular.bootstrap($('#novelApp'), ['novelApp']);
            }); // end require4

        }); // end pnHook
    </script>
}


<h2>Form</h2>

<div id="novelApp">
    <form class="" ng-controller="NovelEntryController as vm" ng-init="vm.step = 1" method="POST" action="form">
        <div id="entry" ng-show="vm.step == 1">
            <div class="form-group">
                <label id="labeltitle" for="title" class="arrow_box">Enter title of novel</label>
                <input id="title" name="title" type="text" class="form-control" ng-model="vm.chapter.title" placeholder="Enter title" aria-labelledby="labeltitle">
            </div>
            <div class="form-group">
                <label id="labelsynopsis" for="synopsis" class="arrow_box">Enter synopsis</label>
                <textarea id="synopsis" name="synopsis" class="form-control" rows="3" ng-model="vm.chapter.content" placeholder="Enter content" aria-labelledby="labelsynopsis"></textarea>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary"><i class="fa fa-plus-circle"></i>Add Novel</button>
            </div>
        </div>

    </form>

</div>